configuration:
  dependencies:
  - "mvn://org.codehaus.groovy:groovy-all:pom:2.5.23"
  - "mvn://org.python:jython-standalone:2.7.4"
  - "mvn://org.jruby:jruby:9.1.17.0"
  - "mvn://com.walmartlabs.concord.plugins.basic:ansible-tasks:2.14.0"
  runtime: "concord-v2"

flows:
  default:
  - set:
      date: "${datetime.format(datetime.current(), 'dd_MM_yyyy')}"
      groupName: "test"
      url: "https://192.168.56.10"
  - task: http
    in:
     method: GET
     auth:
      basic:
        username: "admin"
        password: "_FJxZfySmLXIr9AtjhWOfQ"
     url: ${url}/api/usergroups
     response: "json"
     ignoreSslErrors: true
    out: rsp
     
  - log: "statusCode: ${rsp.content}"

  - script: python
    body: |
      import json
      
      # Parse the HTTP response
      response_data = json.loads(rsp['content'])
      
      # Find the group with matching name
      group_id = None
      for group in response_data.get('results', []):
          if group.get('name') == groupName:
              group_id = group.get('id')
              break
      
      if group_id is None:
          raise Exception(f"Group '{groupName}' not found")
      
      result.set('groupId', group_id)
      print(f"Found group '{groupName}' with ID: {group_id}")
    out:
      groupId: "${result.groupId}"
