configuration:
  dependencies:
    - "mvn://com.walmartlabs.concord.plugins:http-tasks:1.92.0"
  
  arguments:
    apiBaseUrl: "https://192.168.56.10/api"
    adminUser: "admin"
    adminPassword: "-NAHCyL6QRqgYrGc-Wdfsg"

flows:
  default:
    - log: "Creating usergroup and external usergroup mapping"
    
    # Create usergroup
    - task: http
      in:
        url: "${apiBaseUrl}/usergroups"
        method: "POST"
        headers:
          Content-Type: "application/json"
        auth:
          basic:
            username: "${adminUser}"
            password: "${adminPassword}"
        body:
          usergroup:
            name: "marketingops"
            admin: true
        ignoreErrors: false
        connectTimeout: 30000
        readTimeout: 60000
        verifySsl: false
      out: createUsergroupResponse
    
    - log: "Usergroup created successfully: ${createUsergroupResponse}"
    
    # Create external usergroup mapping
    - task: http
      in:
        url: "${apiBaseUrl}/usergroups/16/external_usergroups"
        method: "POST"
        headers:
          Content-Type: "application/json"
        auth:
          basic:
            username: "${adminUser}"
            password: "${adminPassword}"
        body:
          external_usergroup:
            auth_source_id: 4
            name: "marketingops"
        ignoreErrors: false
        connectTimeout: 30000
        readTimeout: 60000
        verifySsl: false
      out: createExternalUsergroupResponse
    
    - log: "External usergroup mapping created successfully: ${createExternalUsergroupResponse}"
